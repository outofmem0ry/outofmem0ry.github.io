---
layout: post
title: "PKS Workshop - Day III"
date: 2019-06-13 17:49
author: "@outofmem0ry"
tags: [beginner, workshop, webapp, kubernetes, docker, pks]
categories: beginner
terms: 2
summary: PKS upgrade and application deployment
---
## What are we goinng to deploy? ü§î

This workshop's website ‚ò∏Ô∏èüê≥üì¶üö¢

## Deploying a containerized static github website

We'll deploying the static website that is being used for this workshop. High level overview of what we are going to do

- Get the app source code for the static web app ‚ÑπÔ∏è
- Package the app into a docker image üì¶
- Run the image locally on your machine üê≥
- Push the image to docker hub ‚è´
- Deploy the app to the cluster ‚ò∏Ô∏è
- Expose your app üîÆ

### Step 1: Getting the application source code ‚ÑπÔ∏è

The source code for this app is available [here](https://github.com/outofmem0ry/outofmem0ry.github.io.git)

```shell
git clone https://github.com/outofmem0ry/outofmem0ry.github.io.git
```

### Step 2: Building a container image üì¶

- To package this app we need the source code and a Dockerfile. Thet both are available in the repo we cloned in the last step.

  ```shell
  cd outofmem0ry.github.io/
  ```

- In the first terminal, set an environment variable for your [Docker Hub](https://hub.docker.com) user name. It can be the same [Docker Hub](https://hub.docker.com) user name that you used to log in to the terminals on this site.

  ```shell
  export USERNAME=YourUserName
  ```

- Make sure you're still in the `outofmem0ry.github.io` directory.

  ```shell
  pwd
  ```

- Login to your docker hub account using `docker login` 
- Build and tag the docker image
  
  ```shell
  docker build . -t $USERNAME/pks_workshop
  ```

- The image should be present locally now. You can check using `docker images`

### Step 3: Run the image on your local machine

- Before deploying this application on our cluster let's try to deploy this application on our local machine.

  ```shell
  docker run -d -p 4000:4000 --name $USERNAME -v "$PWD":/srv/jekyll $USERNAME/pks_workshop
  ```

- Browse the app at `localhost:4000`

### Step 4: Push the image to docker hub

```shell
docker push $USERNAME/pks_workshop
```

### Step 5: Deploy the app to the cluster

```shell
kubectl run $USERNAME --image=$USERNAME/pks_workshop
```

### Step 6: Expose your deployment

```shell
kubectl expose deployment $USERNAME \
--type=NodePort \
--port=4000 \
--target-port=4000
```

## Accessing the web app

- After the deployment is exposed it creates a service. You can view this service using
  
  ```shell
  kubectl describe svc $USERNAME
  ```

- The web app can be accessed using a combination of your worker node IPs and node port from the `kubectl describe` output
  
  ```shell
  kubectl get nodes -o wide
  ```

- Open `workerNodeIP:NodePort` in your browsers
